
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>block</title>
    <script src="../Contents/JS/jquery-3.4.1.js"></script>-
    <script src="../Contents/JS/javascript.js"></script>
    <link rel="stylesheet" href="../Contents/CSS/style.css">
    <link rel="stylesheet" href="http://www.websansite.com/themes/websan/assets/theme/fonts.css">
    <link rel="stylesheet" href="http://cdn.websansite.com/libs.css">
    <script src="http://cdn.websansite.com/libs.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>






</head>

<body>
    <section id="login">
        <div class="container">
            <!-- first row -->
            <div class="row" id="a">
                <div class="col-6">
                    <h4 id="ee">    مدیریت اعلانات گروه خبری  </h4>
                </div>
                <div class="col-6" id="c">

                </div>
            </div>

            <!-- secound row -->
            <div class="row" id="d">
                <div class="col-12 col-lg-12" id="l">
                    <form action="#">
                        <div class="form-group">
                            <label for="exampleFormControlTextarea1" id="ee">متن اعلان</label>
                            <textarea id="notificationText" class="form-control" rows="3"></textarea>
                        </div>



                        <label for="exampleFormControlTextarea1" id="ee">نوع انتشار</label>




                        <div class="accordion" id="accordionExample">
                            <div class="card">
                                <div class="card-header" id="headingOne">
                                    <h2 class="mb-0">
                                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">


                                            <label for="exampleFormControlTextarea1" id="ee">   صفحه نمایشگر </label>


                                        </button>
                                    </h2>
                                </div>

                                <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
                                    <div class="card-body">

                                        <div class="row">
                                            <div class="col-9">
                                                <div class="form-group">
                                                    <label for="exampleFormControlTextarea2" id="ee">دانشگاه :</label>
                                                    <span id="universitySpan">

                                                    </span>


                                                </div>
                                            </div>
                                            <div class="col-3">
                                                <span id="screenId1">

                                                </span>

                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-9">
                                                <div class="form-group">

                                                    <span id="CollegeId">

                                                    </span>

                                                </div>
                                            </div>
                                            <div class="col-3">
                                                <span id="screenId2">

                                                </span>

                                            </div>
                                        </div>


                                        <div class="row">
                                            <div class="col-9">
                                                <div class="form-group">
                                                    <span id="locationId">

                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col-3">

                                                <span id="screenId3">

                                                </span>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <label for="example" id="ee"> تعداد دفعات تکرار در روز : </label>
                                                    <input type="number" class="form-control" id="countDay" aria-describedby="emailHelp">
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <label for="example" id="ee"> زمانبندی : </label>
                                                    <input class="form-control" type="datetime-local" value="2011-08-19T13:45:00" id="timer">
                                                </div>
                                            </div>

                                        </div>




                                        <div class="form-group">
                                            <label id="ee">اعلان فوری است ؟</label>
                                            <div class="custom-control custom-radio custom-control-inline">
                                                <input type="radio" id="customRadioInline1" name="customRadioInline1" value="1"
                                                       class="custom-control-input">
                                                <label class="custom-control-label" for="customRadioInline1">بله</label>
                                            </div>
                                            <div class="custom-control custom-radio custom-control-inline">
                                                <input type="radio" id="customRadioInline2" name="customRadioInline1" value="2"
                                                       class="custom-control-input">
                                                <label class="custom-control-label" for="customRadioInline2">خیر</label>
                                            </div>
                                        </div>














                                    </div>
                                </div>
                            </div>








                            <script>
                                (function ($) {

                                    $.fn.fSelect = function (options) {

                                        if (typeof options == 'string') {
                                            var settings = options;
                                        }
                                        else {
                                            var settings = $.extend({
                                                placeholder: 'Select some options',
                                                numDisplayed: 3,
                                                overflowText: '{n} selected',
                                                searchText: 'Search',
                                                showSearch: true
                                            }, options);
                                        }


                                        /**
                                         * Constructor
                                         */
                                        function fSelect(select, settings) {
                                            this.$select = $(select);
                                            this.settings = settings;
                                            this.create();
                                        }


                                        /**
                                         * Prototype class
                                         */
                                        fSelect.prototype = {
                                            create: function () {
                                                this.settings.multiple = this.$select.is('[multiple]');
                                                var multiple = this.settings.multiple ? ' multiple' : '';
                                                this.$select.wrap('<div class="fs-wrap' + multiple + '" tabindex="0"></div>');
                                                this.$select.before('<div class="fs-label-wrap"><div class="fs-label">' + this.settings.placeholder + '</div><span class="fs-arrow"></span></div>');
                                                this.$select.before('<div class="fs-dropdown hidden"><div class="fs-options"></div></div>');
                                                this.$select.addClass('hidden');
                                                this.$wrap = this.$select.closest('.fs-wrap');
                                                this.$wrap.data('id', window.fSelect.num_items);
                                                window.fSelect.num_items++;
                                                this.reload();
                                            },

                                            reload: function () {
                                                if (this.settings.showSearch) {
                                                    var search = '<div class="fs-search"><input type="search" placeholder="' + this.settings.searchText + '" /></div>';
                                                    this.$wrap.find('.fs-dropdown').prepend(search);
                                                }
                                                this.selected = [].concat(this.$select.val()); // force an array
                                                var choices = this.buildOptions(this.$select);
                                                this.$wrap.find('.fs-options').html(choices);
                                                this.reloadDropdownLabel();
                                            },

                                            destroy: function () {
                                                this.$wrap.find('.fs-label-wrap').remove();
                                                this.$wrap.find('.fs-dropdown').remove();
                                                this.$select.unwrap().removeClass('hidden');
                                            },

                                            buildOptions: function ($element) {
                                                var $this = this;

                                                var choices = '';
                                                $element.children().each(function (i, el) {
                                                    var $el = $(el);

                                                    if ('optgroup' == $el.prop('nodeName').toLowerCase()) {
                                                        choices += '<div class="fs-optgroup">';
                                                        choices += '<div class="fs-optgroup-label">' + $el.prop('label') + '</div>';
                                                        choices += $this.buildOptions($el);
                                                        choices += '</div>';
                                                    }
                                                    else {
                                                        var val = $el.prop('value');

                                                        // exclude the first option in multi-select mode
                                                        if (0 < i || '' != val || !$this.settings.multiple) {
                                                            var disabled = $el.is(':disabled') ? ' disabled' : '';
                                                            var selected = -1 < $.inArray(val, $this.selected) ? ' selected' : '';
                                                            choices += '<div class="fs-option' + selected + disabled + '" data-value="' + val + '"><span class="fs-checkbox"><i></i></span><div class="fs-option-label">' + $el.html() + '</div></div>';
                                                        }
                                                    }
                                                });

                                                return choices;
                                            },

                                            reloadDropdownLabel: function () {
                                                var settings = this.settings;
                                                var labelText = [];

                                                this.$wrap.find('.fs-option.selected').each(function (i, el) {
                                                    labelText.push($(el).find('.fs-option-label').text());
                                                });

                                                if (labelText.length < 1) {
                                                    labelText = settings.placeholder;
                                                }
                                                else if (labelText.length > settings.numDisplayed) {
                                                    labelText = settings.overflowText.replace('{n}', labelText.length);
                                                }
                                                else {
                                                    labelText = labelText.join(', ');
                                                }

                                                this.$wrap.find('.fs-label').html(labelText);
                                                this.$select.change();
                                            }
                                        }


                                        /**
                                         * Loop through each matching element
                                         */
                                        return this.each(function () {
                                            var data = $(this).data('fSelect');

                                            if (!data) {
                                                data = new fSelect(this, settings);
                                                $(this).data('fSelect', data);
                                            }

                                            if (typeof settings == 'string') {
                                                data[settings]();
                                            }
                                        });
                                    }


                                    /**
                                     * Events
                                     */
                                    window.fSelect = {
                                        'num_items': 0,
                                        'active_id': null,
                                        'active_el': null,
                                        'last_choice': null,
                                        'idx': -1
                                    };

                                    $(document).on('click', '.fs-option:not(.disabled)', function (e) {
                                        var $wrap = $(this).closest('.fs-wrap');
                                        var do_close = false;

                                        if ($wrap.hasClass('multiple')) {
                                            var selected = [];

                                            // shift + click support
                                            if (e.shiftKey && null != window.fSelect.last_choice) {
                                                var current_choice = parseInt($(this).attr('data-index'));
                                                var do_select = !$(this).hasClass('selected');
                                                var min = Math.min(window.fSelect.last_choice, current_choice);
                                                var max = Math.max(window.fSelect.last_choice, current_choice);

                                                for (i = min; i <= max; i++) {
                                                    $wrap.find('.fs-option[data-index=' + i + ']')
                                                        .not('.hidden, .disabled')
                                                        .each(function () {
                                                            do_select ?
                                                                $(this).addClass('selected') :
                                                                $(this).removeClass('selected');
                                                        });
                                                }
                                            }
                                            else {
                                                window.fSelect.last_choice = parseInt($(this).attr('data-index'));
                                                $(this).toggleClass('selected');
                                            }

                                            $wrap.find('.fs-option.selected').each(function (i, el) {
                                                selected.push($(el).attr('data-value'));
                                            });
                                        }
                                        else {
                                            var selected = $(this).attr('data-value');
                                            $wrap.find('.fs-option').removeClass('selected');
                                            $(this).addClass('selected');
                                            do_close = true;
                                        }

                                        $wrap.find('select').val(selected);
                                        $wrap.find('select').fSelect('reloadDropdownLabel');

                                        if (do_close) {
                                            closeDropdown($wrap);
                                        }
                                    });

                                    $(document).on('keyup', '.fs-search input', function (e) {
                                        if (40 == e.which) { // down
                                            $(this).blur();
                                            return;
                                        }

                                        var $wrap = $(this).closest('.fs-wrap');
                                        var matchOperators = /[|\\{}()[\]^$+*?.]/g;
                                        var keywords = $(this).val().replace(matchOperators, '\\$&');

                                        $wrap.find('.fs-option, .fs-optgroup-label').removeClass('hidden');

                                        if ('' != keywords) {
                                            $wrap.find('.fs-option').each(function () {
                                                var regex = new RegExp(keywords, 'gi');
                                                if (null === $(this).find('.fs-option-label').text().match(regex)) {
                                                    $(this).addClass('hidden');
                                                }
                                            });

                                            $wrap.find('.fs-optgroup-label').each(function () {
                                                var num_visible = $(this).closest('.fs-optgroup').find('.fs-option:not(.hidden)').length;
                                                if (num_visible < 1) {
                                                    $(this).addClass('hidden');
                                                }
                                            });
                                        }

                                        setIndexes($wrap);
                                    });

                                    $(document).on('click', function (e) {
                                        var $el = $(e.target);
                                        var $wrap = $el.closest('.fs-wrap');

                                        if (0 < $wrap.length) {

                                            // user clicked another fSelect box
                                            if ($wrap.data('id') !== window.fSelect.active_id) {
                                                closeDropdown();
                                            }

                                            // fSelect box was toggled
                                            if ($el.hasClass('fs-label') || $el.hasClass('fs-arrow')) {
                                                var is_hidden = $wrap.find('.fs-dropdown').hasClass('hidden');

                                                if (is_hidden) {
                                                    openDropdown($wrap);
                                                }
                                                else {
                                                    closeDropdown($wrap);
                                                }
                                            }
                                        }
                                            // clicked outside, close all fSelect boxes
                                        else {
                                            closeDropdown();
                                        }
                                    });

                                    $(document).on('keydown', function (e) {
                                        var $wrap = window.fSelect.active_el;
                                        var $target = $(e.target);

                                        // toggle the dropdown on space
                                        if ($target.hasClass('fs-wrap')) {
                                            if (32 == e.which) {
                                                $target.find('.fs-label').trigger('click');
                                                return;
                                            }
                                        }
                                            // preserve spaces during search
                                        else if (0 < $target.closest('.fs-search').length) {
                                            if (32 == e.which) {
                                                return;
                                            }
                                        }
                                        else if (null === $wrap) {
                                            return;
                                        }

                                        if (38 == e.which) { // up
                                            e.preventDefault();

                                            $wrap.find('.fs-option').removeClass('hl');

                                            if (window.fSelect.idx > 0) {
                                                window.fSelect.idx--;
                                                $wrap.find('.fs-option[data-index=' + window.fSelect.idx + ']').addClass('hl');
                                                setScroll($wrap);
                                            }
                                            else {
                                                window.fSelect.idx = -1;
                                                $wrap.find('.fs-search input').focus();
                                            }
                                        }
                                        else if (40 == e.which) { // down
                                            e.preventDefault();

                                            var last_index = $wrap.find('.fs-option:last').attr('data-index');
                                            if (window.fSelect.idx < parseInt(last_index)) {
                                                window.fSelect.idx++;
                                                $wrap.find('.fs-option').removeClass('hl');
                                                $wrap.find('.fs-option[data-index=' + window.fSelect.idx + ']').addClass('hl');
                                                setScroll($wrap);
                                            }
                                        }
                                        else if (32 == e.which || 13 == e.which) { // space, enter
                                            e.preventDefault();

                                            $wrap.find('.fs-option.hl').click();
                                        }
                                        else if (27 == e.which) { // esc
                                            closeDropdown($wrap);
                                        }
                                    });

                                    function setIndexes($wrap) {
                                        $wrap.find('.fs-option:not(.hidden,.disabled)').each(function (i, el) {
                                            $(el).attr('data-index', i);
                                            $wrap.find('.fs-option').removeClass('hl');
                                        });
                                        $wrap.find('.fs-search input').focus();
                                        window.fSelect.idx = -1;
                                    }

                                    function setScroll($wrap) {
                                        var $container = $wrap.find('.fs-options');
                                        var $selected = $wrap.find('.fs-option.hl');

                                        var itemMin = $selected.offset().top + $container.scrollTop();
                                        var itemMax = itemMin + $selected.outerHeight();
                                        var containerMin = $container.offset().top + $container.scrollTop();
                                        var containerMax = containerMin + $container.outerHeight();

                                        if (itemMax > containerMax) { // scroll down
                                            var to = $container.scrollTop() + itemMax - containerMax;
                                            $container.scrollTop(to);
                                        }
                                        else if (itemMin < containerMin) { // scroll up
                                            var to = $container.scrollTop() - containerMin - itemMin;
                                            $container.scrollTop(to);
                                        }
                                    }

                                    function openDropdown($wrap) {
                                        window.fSelect.active_el = $wrap;
                                        window.fSelect.active_id = $wrap.data('id');
                                        window.fSelect.initial_values = $wrap.find('select').val();
                                        $wrap.find('.fs-dropdown').removeClass('hidden');
                                        setIndexes($wrap);
                                    }

                                    function closeDropdown($wrap) {
                                        if ('undefined' == typeof $wrap && null != window.fSelect.active_el) {
                                            $wrap = window.fSelect.active_el;
                                        }
                                        if ('undefined' !== typeof $wrap) {
                                            // only trigger if the values have changed
                                            var initial_values = window.fSelect.initial_values;
                                            var current_values = $wrap.find('select').val();
                                            if (JSON.stringify(initial_values) != JSON.stringify(current_values)) {
                                                $(document).trigger('fs:changed', $wrap);
                                            }
                                        }

                                        $('.fs-dropdown').addClass('hidden');
                                        window.fSelect.active_el = null;
                                        window.fSelect.active_id = null;
                                        window.fSelect.last_choice = null;
                                    }

                                })(jQuery);

                                $(document).ready(function () {
                                    $('.test').fSelect({ forceCustomRendering: true });
                                });


                            </script>











                    </form>
                    <div class="row">
                        <div class="col-6">
                            <input type="button" class="btn text-white btn-orange" value="ورود" onclick="InsertData()" id="j" />

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>






</body>

</html>

<script>
    $(document).ready(
            function () {
                $.ajax({
                    type: "post",
                    url: "../../NewsManegment/GetUniversity",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {

                        for (i = 0; i < data.length; i++) {
                            $('#universitySpan').append(' <div class="custom-control custom-radio custom-control-inline">' +
                                '<input type="radio" name="UniversityUnits" id="unitUniversity'
                                 + data[i].Id + '" onclick="CollegeRecords(' + data[i].Id + ')" class="custom-control-input" value="'
                                + data[i].Id + '"><label class="custom-control-label" for="unitUniversity'
                                + data[i].Id + '" >' + data[i].Title + '</label></div>');
                        }


                    }
                })

            }
        );




    function CollegeRecords(id) {

        $('.colleges').remove();
        $.ajax({
            type: "post",
            url: "../../NewsManegment/GetCollege/" + id,
            contentType: "application/json; charset=utf-8",
            dataType: "json",

            success: function (data) {
                if (id != 1) {
                    $('.screenIdApp1').remove();

                    $('#CollegeId').append('<snap class="colleges"><label for="exampleFormControlTextarea2" id="ee">دانشکده :</label></span>');
                    for (i = 0; i < data.length; i++) {
                        $('#CollegeId').append('<snap class="colleges"> <div class="custom-control custom-radio custom-control-inline">' +
                            '<input type="radio" name="CollegeUnits" id="CollegeRecords'
                             + data[i].Id + '" onclick="LocationRecords(' + data[i].Id + ')" class="custom-control-input" value="'
                            + data[i].Id + '"><label class="custom-control-label" for="CollegeRecords'
                            + data[i].Id + '" >' + data[i].Title + '</label></div></span>');
                    }
                }
                else {
                    $('.colleges').remove();
                    $.ajax({
                        type: "post",
                        url: "../../NewsManegment/GetScreen",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",

                        success: function (data) {
                            $('#screenId1').append('<select class="screenIdApp1" id="ScreenSelect1"></select>');
                            for (i = 0; i < data.length; i++) {
                                $('#ScreenSelect1').append('<option  value="' + data[i].Id + '">' + data[i].Title + '</option>');
                            }
                        }
                    })

                }

            }
        })
    }

    function LocationRecords(id) {

        $('.locations').remove();
        $.ajax({
            type: "post",
            url: "../../NewsManegment/GetLocation/" + id,
            contentType: "application/json; charset=utf-8",
            dataType: "json",

            success: function (data) {
                if (id != 1) {
                    $('.screenApp2').remove();

                    $('#locationId').append('<snap class="locations"><label for="exampleFormControlTextarea2" id="ee">مکان :</label></span>');
                    for (i = 0; i < data.length; i++) {
                        $('#locationId').append('<snap class="locations"> <div class="custom-control custom-radio custom-control-inline">' +
                            '<input type="radio" name="LocationUnits" id="LocationRecords'
                             + data[i].Id + '" class="custom-control-input" value="'
                            + data[i].Id + '"><label class="custom-control-label" for="LocationRecords'
                            + data[i].Id + '" >' + data[i].Title + '</label></div></span>');
                    }


                    $.ajax({
                        type: "post",
                        url: "../../NewsManegment/GetScreen",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",

                        success: function (data) {
                            $('#screenId3').append('<select class="test" id="ScreenSelect3"></select>');
                            for (i = 0; i < data.length; i++) {
                                $('#ScreenSelect3').append('<option value="' + data[i].Id + '">' + data[i].Title + '</option>');
                            }
                        }
                    })

                }

                else {
                    $('.locations').remove();

                    $.ajax({
                        type: "post",
                        url: "../../NewsManegment/GetScreen",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",

                        success: function (data) {
                            $('#screenId2').append('<select class="screenApp2" id="ScreenSelect2"></select>');
                            for (i = 0; i < data.length; i++) {
                                $('#ScreenSelect2').append('<option value="' + data[i].Id + '">' + data[i].Title + '</option>');
                            }


                        }

                    })



                }
            }
        })
    }


    function InsertData() {

        var select1 = 0;
        var select2 = 0;
        var select3 = 0;

        if (document.getElementById("ScreenSelect1") != null) {
            select1 = document.getElementById("ScreenSelect1").value;
        }
        if (document.getElementById("ScreenSelect2") != null) {
            select2 = document.getElementById("ScreenSelect2").value;
        }
        if (document.getElementById("ScreenSelect3") != null) {
            select3 = document.getElementById("ScreenSelect3").value;
        }

        var url = window.location.href;
        var id = url.split("=");
        var model = {
            TextShow: $("#notificationText").val(),
            UniversityScreenShow: select1,
            CollegeScreenShow: select2,
            LocationScreenShow: select3,
            FrequenceShow: $("#countDay").val(),
            ScheduleShow: $("#timer").val(),
            UrgentShow: document.querySelector('input[name="customRadioInline1"]:checked').value,
            TypeId: id[1],

        };
        console.log(model);
        $.ajax({
            type: "POST",
            url: "../../NewsManegment/InsertNotification",
            data: JSON.stringify(model),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (msg) {
                $("#notificationText").val("");
                $("#countDay").val("");
                $("#timer").val("");
                $("input:radio").attr("checked", false);
                alert("اطلاعات شما با موفقیت ثبت شد.");
            },
            error: function () {
                alert("در هنگام ثبت اطلاعات شما خطایی رخ داده است. لطفا مجددا تلاش کنید.");

            }
        });


    }



</script>